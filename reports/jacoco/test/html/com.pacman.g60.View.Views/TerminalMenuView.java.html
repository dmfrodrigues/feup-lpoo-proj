<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TerminalMenuView.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pacman</a> &gt; <a href="index.source.html" class="el_package">com.pacman.g60.View.Views</a> &gt; <span class="el_source">TerminalMenuView.java</span></div><h1>TerminalMenuView.java</h1><pre class="source lang-java linenums">/**
 * Copyright (C) 2020 Diogo Rodrigues, João Matos
 */

package com.pacman.g60.View.Views;

import com.pacman.g60.Model.Models.MenuModel;
import com.pacman.g60.Model.Position;
import com.pacman.g60.Model.Models.TextModel;
import com.pacman.g60.View.Color;
import com.pacman.g60.View.Font.TerminalFont;
import com.pacman.g60.View.GUI.TerminalGUI;

import java.util.List;

public class TerminalMenuView extends MenuView {
    
    private final TerminalGUI terminalGUI;
    TerminalFont font;
    TerminalTextView textView;
    
    public TerminalMenuView(TerminalGUI terminalGUI, TerminalFont font) {
<span class="nc" id="L23">        super(terminalGUI);</span>
<span class="nc" id="L24">        this.terminalGUI = terminalGUI;</span>
<span class="nc" id="L25">        this.font = font;</span>
<span class="nc" id="L26">        textView = new TerminalTextView(terminalGUI, this.font);</span>
<span class="nc" id="L27">    }</span>
    
    int Wbutton;
<span class="nc" id="L30">    final int Wbutton_margin = 5;</span>
<span class="nc" id="L31">    final int Wframe_margin = 10;</span>
    
    int Htotal;
<span class="nc" id="L34">    final int Hbutton_margin = 0;</span>
<span class="nc" id="L35">    final int Hframe_margin = 3;</span>
    
    private void drawFrame(int x0, int y0){
        
<span class="nc" id="L39">        int Wtotal = Wbutton + 2*font.getW() + 2*Wframe_margin;</span>
<span class="nc" id="L40">        int Wtotal_chars = Wtotal/font.getW();</span>
<span class="nc" id="L41">        int Htotal_chars = Htotal/font.getH();</span>
        
<span class="nc" id="L43">        TextModel textModel = new TextModel(&quot;&quot;);</span>
<span class="nc" id="L44">        textView.setTextModel(textModel);</span>
        
<span class="nc" id="L46">        textModel.setText(&quot;╔&quot; + &quot;═&quot;.repeat(Wtotal_chars-2) + &quot;╗&quot;);</span>
<span class="nc" id="L47">        textModel.setPosition(new Position(x0, y0));</span>
<span class="nc" id="L48">        textView.draw();</span>
        
<span class="nc bnc" id="L50" title="All 2 branches missed.">        for(int y = 1; y &lt; Htotal_chars-1; ++y) {</span>
<span class="nc" id="L51">            textModel.setText(&quot;║&quot;);</span>
            
<span class="nc" id="L53">            textModel.setPosition(new Position(x0, y0+y*font.getH()));</span>
<span class="nc" id="L54">            textView.draw();</span>

<span class="nc" id="L56">            textModel.setPosition(new Position(x0 + (Wtotal_chars-1)*font.getW(), y0+y*font.getH()));</span>
<span class="nc" id="L57">            textView.draw();</span>
        }

<span class="nc" id="L60">        textModel.setText(&quot;╚&quot; + &quot;═&quot;.repeat(Wtotal_chars-2) + &quot;╝&quot;);</span>
<span class="nc" id="L61">        textModel.setPosition(new Position(x0, y0+(Htotal_chars-1)*font.getH()));</span>
<span class="nc" id="L62">        textView.draw();</span>
<span class="nc" id="L63">    }</span>
    
<span class="nc" id="L65">    boolean frame = false;</span>
    private void drawItem(int x0, int y0, int ymin, int ymax, MenuModel.Item item, int index){

<span class="nc" id="L68">        final int Hbutton = 3*font.getH();</span>
        
<span class="nc bnc" id="L70" title="All 2 branches missed.">        int x1 = x0                                  + (frame ? font.getW() + Wframe_margin : 0);</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">        int y1 = y0 + index*(Hbutton+Hbutton_margin) + (frame ? font.getH() + Hframe_margin : 0);</span>
        
<span class="nc" id="L73">        int Wbutton_chars = Wbutton/font.getW();</span>
<span class="nc" id="L74">        int Hbutton_chars = Hbutton/font.getH();</span>

<span class="nc" id="L76">        TextModel textModel = new TextModel(&quot;&quot;);</span>
<span class="nc" id="L77">        textView.setTextModel(textModel);</span>

<span class="nc" id="L79">        textModel.setText(&quot;┌&quot; + &quot;─&quot;.repeat(Wbutton_chars-2) + &quot;┐&quot;);</span>
<span class="nc" id="L80">        textModel.setPosition(new Position(x1, y1));</span>
<span class="nc bnc" id="L81" title="All 4 branches missed.">        if(ymin &lt;= textModel.getPosition().getY() &amp;&amp; textModel.getPosition().getY() &lt;= ymax) textView.draw();</span>

<span class="nc" id="L83">        textModel.setText(&quot;│&quot;);</span>
        
<span class="nc bnc" id="L85" title="All 2 branches missed.">        for(int y = 1; y &lt; Hbutton_chars-1; ++y) {</span>
<span class="nc" id="L86">            textModel.setPosition(new Position(x1, y1+y*font.getH()));</span>
<span class="nc bnc" id="L87" title="All 4 branches missed.">            if(ymin &lt;= textModel.getPosition().getY() &amp;&amp; textModel.getPosition().getY() &lt;= ymax) textView.draw();</span>
            
<span class="nc" id="L89">            textModel.setPosition(new Position(x1 + (Wbutton_chars-1)*font.getW(), y1+y*font.getH()));</span>
<span class="nc bnc" id="L90" title="All 4 branches missed.">            if(ymin &lt;= textModel.getPosition().getY() &amp;&amp; textModel.getPosition().getY() &lt;= ymax) textView.draw();</span>
        }

<span class="nc" id="L93">        textModel.setText(&quot;└&quot; + &quot;─&quot;.repeat(Wbutton_chars-2) + &quot;┘&quot;);</span>
<span class="nc" id="L94">        textModel.setPosition(new Position(x1, y1+(Hbutton_chars-1)*font.getH()));</span>
<span class="nc bnc" id="L95" title="All 4 branches missed.">        if(ymin &lt;= textModel.getPosition().getY() &amp;&amp; textModel.getPosition().getY() &lt;= ymax) textView.draw();</span>

<span class="nc" id="L97">        int x2 = x1 + (Wbutton - textView.getStringWidth (item.getText()))/2;</span>
<span class="nc" id="L98">        int y2 = y1 + (Hbutton - textView.getStringHeight(item.getText()))/2;</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">        if(item.isSelected()) {</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">            for (int x = x1 + font.getW(); x &lt; x1 + (Wbutton_chars - 1) * font.getW(); ++x) {</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">                for (int y = y1 + font.getH(); y &lt; y1 + (Hbutton_chars - 1) * font.getH(); ++y) {</span>
<span class="nc bnc" id="L102" title="All 4 branches missed.">                    if(ymin &lt;= y &amp;&amp; y &lt;= ymax)</span>
<span class="nc" id="L103">                        terminalGUI.drawCharacter(x, y, ' ', Color.WHITE, Color.DARK_GREY);</span>
                }
            }
<span class="nc" id="L106">            textModel.setBackgroundColor(Color.DARK_GREY);</span>
        }
<span class="nc" id="L108">        textModel.setPosition(new Position(x2, y2));</span>
<span class="nc" id="L109">        textModel.setText(item.getText());</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">        textModel.setForegroundColor((item.getEnabled() ? Color.WHITE : Color.GREY));</span>
<span class="nc bnc" id="L111" title="All 4 branches missed.">        if(ymin &lt;= textModel.getPosition().getY() &amp;&amp; textModel.getPosition().getY() &lt;= ymax) textView.draw();</span>
<span class="nc" id="L112">    }</span>
    
    @Override
    public void draw() {
<span class="nc" id="L116">        MenuModel menu = getMenuModel();</span>

<span class="nc" id="L118">        frame = menu.hasFrame();</span>
        
<span class="nc" id="L120">        Wbutton = 0;</span>
<span class="nc" id="L121">        Htotal  = 0;</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">        for(final MenuModel.Item i: menu.getItems()) {</span>
<span class="nc" id="L123">            Wbutton = Math.max(Wbutton, 2*font.getW() + 2*Wbutton_margin + textView.getStringWidth(i.getText()));</span>
<span class="nc" id="L124">            Htotal += textView.getStringHeight(i.getText()) + Hbutton_margin + 2*font.getH();</span>
<span class="nc" id="L125">        }</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">        if(!menu.getItems().isEmpty()) Htotal -= Hbutton_margin;</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if(frame) {</span>
<span class="nc" id="L128">            Htotal  += 2 * font.getH() + 2 * Hframe_margin;</span>
        }
<span class="nc bnc" id="L130" title="All 2 branches missed.">        int Wtotal = Wbutton + (frame ? 2*font.getW() + 2*Wframe_margin : 0 );</span>
        
<span class="nc" id="L132">        int x0 = (int)(terminalGUI.getW()*menu.getRelativePosition().getX());</span>
<span class="nc bnc" id="L133" title="All 4 branches missed.">        switch(menu.getHorizontalAlign()){</span>
<span class="nc" id="L134">            case LEFT: break;</span>
<span class="nc" id="L135">            case CENTER: x0 = x0 - Wtotal/2; break;</span>
<span class="nc" id="L136">            case RIGHT: x0 = x0 - Wtotal; break;</span>
        }

<span class="nc" id="L139">        int y0 = (int)(terminalGUI.getH()*menu.getRelativePosition().getY());</span>
<span class="nc bnc" id="L140" title="All 4 branches missed.">        switch(menu.getVerticalAlign()){</span>
<span class="nc" id="L141">            case TOP: break;</span>
<span class="nc" id="L142">            case CENTER: y0 = y0 - Htotal/2; break;</span>
<span class="nc" id="L143">            case BOTTOM: y0 = y0 - Htotal; break;</span>
        }
        
<span class="nc" id="L146">        Htotal = Math.min(Htotal, terminalGUI.getH() - y0);</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">        if(frame) Htotal -= Htotal % font.getH();</span>
        
<span class="nc" id="L149">        List&lt;MenuModel.Item&gt; items = menu.getItems();</span>

<span class="nc" id="L151">        final int Hbutton = 3*font.getH();</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">        final int ymin = (frame ? y0+font.getH() : y0 );</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">        final int ymax = (frame ? y0+Htotal-font.getH()-1 : terminalGUI.getH()-1);</span>
        
        int i_selected;
<span class="nc" id="L156">        i_selected = 0;</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">        while (!items.get(i_selected).isSelected()) ++i_selected;</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">        int y_selected = y0 + i_selected*(Hbutton+Hbutton_margin) + (frame ? font.getH() + Hframe_margin : 0 );</span>
<span class="nc" id="L159">        int y_selected_bottom = y_selected + Hbutton - 1;</span>
<span class="nc" id="L160">        int delta_y = Math.max(0, y_selected_bottom - ymax);</span>
        
<span class="nc bnc" id="L162" title="All 2 branches missed.">        for(int i = 0; i &lt; items.size(); ++i){</span>
<span class="nc" id="L163">            drawItem(x0, y0-delta_y, ymin, ymax, items.get(i), i);</span>
        }

<span class="nc bnc" id="L166" title="All 2 branches missed.">        if(frame) {</span>
<span class="nc" id="L167">            drawFrame(x0, y0);</span>
        }
<span class="nc" id="L169">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>