<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TerminalMenuView.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">pacman</a> &gt; <a href="index.source.html" class="el_package">com.pacman.g60.View</a> &gt; <span class="el_source">TerminalMenuView.java</span></div><h1>TerminalMenuView.java</h1><pre class="source lang-java linenums">package com.pacman.g60.View;

import com.googlecode.lanterna.input.KeyStroke;
import com.googlecode.lanterna.input.KeyType;
import com.pacman.g60.Model.MenuModel;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public class TerminalMenuView implements MenuView {
    
    public interface Loader {
        TerminalSprite[][] getOuterEdge();
        TerminalSprite[][] getInnerEdge();
    }
    
    private TerminalGUI terminalGUI;
    TerminalFont font;
    TerminalTextView textView;
    
<span class="nc" id="L25">    public TerminalMenuView(TerminalGUI terminalGUI) throws FileNotFoundException {</span>
<span class="nc" id="L26">        this.terminalGUI = terminalGUI;</span>
<span class="nc" id="L27">        TerminalFont.Loader loader = new TerminalFontLoaderStream(new FileInputStream(&quot;src/main/resources/lanterna-sprites/numbers-4-3.lan&quot;));</span>
<span class="nc" id="L28">        font = loader.getTerminalFont();</span>
<span class="nc" id="L29">        textView = new TerminalTextView(terminalGUI, font);</span>
<span class="nc" id="L30">    }</span>
    
    @Override
    public COMMAND pollCommand() throws IOException {
<span class="nc" id="L34">        KeyStroke key = terminalGUI.pollKey();</span>
<span class="nc bnc" id="L35" title="All 2 branches missed.">        if(key == null) return null;</span>
<span class="nc bnc" id="L36" title="All 2 branches missed.">        if(key.getKeyType() == KeyType.ArrowUp  ) return COMMAND.UP;</span>
<span class="nc bnc" id="L37" title="All 2 branches missed.">        if(key.getKeyType() == KeyType.ArrowDown) return COMMAND.DOWN;</span>
<span class="nc bnc" id="L38" title="All 2 branches missed.">        if(key.getKeyType() == KeyType.Enter    ) return COMMAND.ENTER;</span>
<span class="nc bnc" id="L39" title="All 2 branches missed.">        if(key.getKeyType() == KeyType.Escape   ) return COMMAND.EXIT;</span>
<span class="nc bnc" id="L40" title="All 2 branches missed.">        if(key.getKeyType() == KeyType.EOF      ) return COMMAND.EXIT;</span>
<span class="nc" id="L41">        return null;</span>
    }

<span class="nc" id="L44">    final int Wbutton = 12;</span>
<span class="nc" id="L45">    final int Wbutton_margin = 1;</span>
<span class="nc" id="L46">    final int Wmenu_margin = 2;</span>
<span class="nc" id="L47">    final int Wtotal = Wbutton+2*Wbutton_margin+2+Wmenu_margin+2;</span>

<span class="nc" id="L49">    final int Hbutton = 1;</span>
<span class="nc" id="L50">    final int Hbutton_margin = 0;</span>
<span class="nc" id="L51">    final int Hmenu_margin = 1;</span>
    int Htotal;
    int x0;
    int y0;

    private void drawFrame(MenuModel menu){
<span class="nc" id="L57">        textView.draw(x0, y0, &quot;╔&quot;);</span>
<span class="nc" id="L58">        textView.draw(x0+font.getW(), y0, &quot;═&quot;.repeat(Wtotal-2));</span>
<span class="nc" id="L59">        textView.draw(x0+(Wtotal-1)*font.getW(), y0, &quot;╗&quot;);</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">        for(int y = 1; y &lt; Htotal-1; ++y) {</span>
<span class="nc" id="L61">            textView.draw(x0, y0+y*font.getH(), &quot;║&quot;);</span>
<span class="nc" id="L62">            textView.draw(x0+(Wtotal-1)*font.getW(), y0+y*font.getH(), &quot;║&quot;);</span>
        }

<span class="nc" id="L65">        textView.draw(x0, y0+(Htotal-1)*font.getH(), &quot;╚&quot;);</span>
<span class="nc" id="L66">        textView.draw(x0+font.getW(), y0+(Htotal-1)*font.getH(), &quot;═&quot;.repeat(Wtotal-2));</span>
<span class="nc" id="L67">        textView.draw(x0+(Wtotal-1)*font.getW(), y0+(Htotal-1)*font.getH(), &quot;╝&quot;);</span>
<span class="nc" id="L68">    }</span>
    
    private void drawItem(MenuModel.Item item, int index){
<span class="nc" id="L71">        int x1 = x0 + (1 + Wmenu_margin)*font.getW();</span>
<span class="nc" id="L72">        int y1 = y0 + (1 + Hmenu_margin + index*(Hbutton+2))*font.getH();</span>
<span class="nc" id="L73">        textView.draw(x1, y1, &quot;┌&quot;);</span>
<span class="nc" id="L74">        textView.draw(x1+font.getW(), y1, &quot;─&quot;.repeat(Wbutton));</span>
<span class="nc" id="L75">        textView.draw(x1+(Wbutton+1)*font.getW(), y1, &quot;┐&quot;);</span>

<span class="nc bnc" id="L77" title="All 2 branches missed.">        for(int y = 1; y &lt; Hbutton+1; ++y) {</span>
<span class="nc" id="L78">            textView.draw(x1, y1+y*font.getH(), &quot;│&quot;);</span>
<span class="nc" id="L79">            textView.draw(x1+(Wbutton+1)*font.getW(), y1+y*font.getH(), &quot;│&quot;);</span>
        }

<span class="nc" id="L82">        textView.draw(x1, y1+(Hbutton+1)*font.getH(), &quot;└&quot;);</span>
<span class="nc" id="L83">        textView.draw(x1+font.getW(), y1+(Hbutton+1)*font.getH(), &quot;─&quot;.repeat(Wbutton));</span>
<span class="nc" id="L84">        textView.draw(x1+(Wbutton+1)*font.getW(), y1+(Hbutton+1)*font.getH(), &quot;┘&quot;);</span>

<span class="nc" id="L86">        int x2 = x1 + (((Wbutton+2)*font.getW()) - textView.getStringWidth (item.getText()))/2;</span>
<span class="nc" id="L87">        int y2 = y1 + (((Hbutton+2)*font.getH()) - textView.getStringHeight(item.getText()))/2;</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">        if(item.isSelected()) {</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">            for (int x = x1 + font.getW(); x &lt; x1 + (Wbutton + 1) * font.getW(); ++x) {</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">                for (int y = y1 + font.getH(); y &lt; y1 + (Hbutton + 1) * font.getH(); ++y) {</span>
<span class="nc" id="L91">                    terminalGUI.drawCharacter(x, y, ' ', Color.WHITE, Color.GREY);</span>
                }
            }
<span class="nc" id="L94">            textView.draw(x2, y2, item.getText(), Color.WHITE, Color.GREY);</span>
        } else {
<span class="nc" id="L96">            textView.draw(x2, y2, item.getText());</span>
        }
<span class="nc" id="L98">    }</span>
    
    @Override
    public void draw(MenuModel menu) throws IOException {
<span class="nc" id="L102">        terminalGUI.clear();</span>
<span class="nc" id="L103">        Htotal = (Hbutton+2)*menu.getItems().size() + 2*Hmenu_margin + 2;</span>
<span class="nc" id="L104">        x0 = terminalGUI.getW()/2 - Wtotal*font.getW()/2;</span>
<span class="nc" id="L105">        y0 = terminalGUI.getH()/2 - Htotal*font.getH()/2;</span>
<span class="nc" id="L106">        drawFrame(menu);</span>
        
<span class="nc" id="L108">        List&lt;MenuModel.Item&gt; items = menu.getItems();</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">        for(int i = 0; i &lt; items.size(); ++i){</span>
<span class="nc" id="L110">            drawItem(items.get(i), i);</span>
        }
        
<span class="nc" id="L113">        terminalGUI.refresh();</span>
<span class="nc" id="L114">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>